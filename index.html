<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>api-ccminer</title>
    <style>
        body { font-family: monospace; background-color: black; color: white; }
        h2 { color: cyan; } /* Naslov v cyan */
        h3 { color: darkgoldenrod; } /* Datum in ura v temnejši rumeni */
        
        .container { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; }
        .table-container { flex: 1; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid gray; padding: 5px; text-align: left; white-space: nowrap; }
        th { background-color: #222; height: 30px; } /* Glava tabel enake višine */
        
        /* Pool barve */
        .pool-off-line { color: red; }
        .pool-not-on-list { color: red; }
        .pool-farm { color: lime; }
        .pool-verus { color: orange; }
        .pool-luckpool { color: yellow; }
        .pool-vipor { color: violet; }

        /* Stilizacija sort-table */
        .sort-table th { 
            background-color: #222; /* Enaka barva kot pool */
            height: 30px; /* Enaka višina kot v ostalih tabelah */
            text-align: center;
        }
        .sort-data { padding: 10px; white-space: pre-wrap; text-align: center; }
    </style>
</head>
<body>

    <h2>api-ccminer by blbMS 2025 v.014</h2>
    <h3 id="date-container"></h3>

    <div class="container" id="tables-container"></div>
    <div class="summ-container" id="summ-container"></div>
    <div class="sort-container" id="sort-container"></div>

    <script>
        async function loadData() {
            const url = "data.json";
            const response = await fetch(url);
            const data = await response.json();

            document.getElementById("date-container").innerText = data.DATE[0];

            createDeviceTable(data.DATA);
            createSummTable(data.SUMM);
            createSortTable(data.SORT);
        }

        function createDeviceTable(devices) {
            const tablesContainer = document.getElementById("tables-container");
            tablesContainer.innerHTML = "";

            devices.forEach(item => {
                let poolColorClass = getPoolColorClass(item.POOL);
                let tableHTML = `
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>DEVICE</th>
                                    <th>IP</th>
                                    <th>POOL</th>
                                    <th>MHS</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>${item.PHONE}</td>
                                    <td>${item.HOST}</td>
                                    <td class="${poolColorClass}">${item.POOL}</td>
                                    <td>${item.MHS}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>`;
                tablesContainer.innerHTML += tableHTML;
            });
        }

        function createSummTable(summData) {
            let summContainer = document.getElementById("summ-container");
            summContainer.innerHTML = "";

            if (!summData || summData.length === 0) return;

            let summ = summData[0];

            let tableHTML = `
                <div class="table-container">
                    <table>
                        <tr><th>Total Devices</th><td>${summ.all_dev}</td></tr>
                        <tr><th>Active</th><td>${summ.dev_active}</td></tr>
                        <tr><th>Inactive</th><td>${summ.dev_inactive}</td></tr>
                        <tr><th>Offline</th><td>${summ.dev_off}</td></tr>
                    </table>
                </div>
                <div class="table-container">
                    <table>
                        <tr><th>Total MHS</th><td>${summ.mhs_all}</td></tr>
                        <tr><th>VRSC/day</th><td>${summ.vrsc_day}</td></tr>
                        <tr><th>USDT/day</th><td>${summ.usdt_day}</td></tr>
                        <tr><th>Time</th><td>${summ.summ_time}</td></tr>
                        <tr><th>Iteration</th><td>${summ.iteration}</td></tr>
                    </table>
                </div>`;

            summContainer.innerHTML = tableHTML;
        }

        function createSortTable(sortData) {
            let sortContainer = document.getElementById("sort-container");
            sortContainer.innerHTML = "";

            if (!sortData || sortData.length === 0) return;

            sortData.forEach(group => {
                let category = Object.keys(group)[0];
                let devices = group[category].join("  "); // Double space between devices
                let poolColorClass = getPoolColorClass(category);

                let tableHTML = `
                    <div class="table-container">
                        <table class="sort-table">
                            <tr><th class="${poolColorClass}">${category}</th></tr>
                            <tr><td class="sort-data">${devices}</td></tr>
                        </table>
                    </div>`;

                sortContainer.innerHTML += tableHTML;
            });
        }

        function getPoolColorClass(pool) {
            if (pool.toLowerCase().includes("off-line")) return "pool-off-line";
            if (pool.toLowerCase().includes("not-on-list")) return "pool-not-on-list";
            if (pool.toLowerCase().includes("farm")) return "pool-farm";
            if (pool.toLowerCase().includes("verus")) return "pool-verus";
            if (pool.toLowerCase().includes("luckpool")) return "pool-luckpool";
            if (pool.toLowerCase().includes("vipor")) return "pool-vipor";
            return "";
        }

        loadData();
        setInterval(loadData, 60 * 1000); 
    </script>

</body>
</html>
